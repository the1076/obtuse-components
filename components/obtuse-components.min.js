var componentsDirectory="/components/",manifestPath="/components/manifest.json",useShadowRoot=!0;const components={},globalStyles=[];export class ObtuseComponentDefinition{constructor(){}async init(){if(null==this.template){let t=await request(this.htmlPath),e=await t.text(),n=(new DOMParser).parseFromString(e,"text/html").querySelector("template");this.template=n}else Object.prototype.toString.call(this.template)&&(this.template=(new DOMParser).parseFromString(this.template,"text/html").querySelector("template"));if(null==this.style){let t=await request(this.stylePath),e=await t.text();this.style=e}if(null==this.module){let t=await import(this.scriptPath);this.module=t.default}}static new(t,e,n,o,a,s){if(null==t||"[object String]"!==Object.prototype.toString.call(t)||""==t.trim())throw new Error("Cannot create a component definition without a componentClassName.");let r=new ObtuseComponentDefinition;r.baseName=toKebabCase(t),r.basePath=n||ObtuseComponents.componentsDirectory+r.baseName+"/";let i=r.basePath+r.baseName;return r.componenentClassName=t,r.tagName=e||r.baseName,r.htmlPath=o||i+".html",r.stylePath=a||i+".css",r.scriptPath=s||i+".js",r.template=null,r.style=null,r.module=null,r}static fromResource(t){if(null==t.componentClassName||"[object String]"!==Object.prototype.toString.call(t.componentClassName)||""==t.componentClassName.trim())throw new Error("Cannot create a component from a manifest entry without a componentClassName.");let e=new ObtuseComponentDefinition;Object.assign(e,t),e.baseName=e.baseName||toKebabCase(t.componentClassName),e.basePath=e.basePath||ObtuseComponents.componentsDirectory+e.baseName+"/";let n=e.basePath+e.baseName;return e.componenentClassName=t.componentClassName,e.tagName=e.tagName||e.baseName,e.htmlPath=e.htmlPath||n+".html",e.stylePath=e.stylePath||n+".css",e.scriptPath=e.scriptPath||n+".js",e.template=e.template||null,e.style=e.style||null,e.module=e.module||null,e}};export class ObtuseComponent extends HTMLElement{static get observedAttributes(){return[]}constructor(){super()}async _init(){}async connectedCallback(){let t=this;ObtuseComponents.useShadowRoot&&(t=this.attachShadow({mode:"open"}));let e=ObtuseComponents.getComponentDefinition(this.constructor.name);t.appendChild(e.template.content.cloneNode(!0)),ObtuseComponents.setStyle(this),await this._init(),this.__isConnected=!0,this.dispatchComponentEvent(this,"onconnect")}disconnectedCallback(){this.__isConnected=!1,this.dispatchComponentEvent(this,"ondisconnect")}adoptedCallback(){this.dispatchComponentEvent(this,"onadopted")}attributeChangedCallback(t,e,n){this.__isConnected&&(console.log({name:t,oldValue:e,newValue:n}),this.dispatchComponentEvent(this,"onattributechanged",{name:t,oldValue:e,newValue:n}))}dispatchComponentEvent(t,e,n){if(t==this){let t=n?new CustomEvent(e,{detail:n}):new CustomEvent(e);this.dispatchEvent(t)}let o="on"+e,a=t.getAttribute(o);if(a)try{(a=a.split(".").reduce((t,e)=>t[e],window))({target:t,detail:n})}catch(t){console.error("Unable to execute callback: "+t.message)}}};export class ObtuseComponents{static get componentsDirectory(){return componentsDirectory}static set componentsDirectory(t){componentsDirectory=t}static get manifestPath(){return manifestPath}static set manifestPath(t){manifestPath=t}static get useShadowRoot(){return useShadowRoot}static set useShadowRoot(t){useShadowRoot=t}static async register(t){null==t&&(t=await getManifest()),Array.isArray(t)||(t=[t]);let e=[];for(let n=0;n<t.length;n++)e.push(register(t[n]));await Promise.allSettled(e)}static getComponentDefinition(t){return components[t]}static setStyle(t){let e=t.constructor.name;if(globalStyles.indexOf(e)>-1&&!useShadowRoot)return;let n=document.createElement("style");n.classList.add("component");let o=components[e].style.replace(/(\r\n?|(\s\s)+)/g,"");n.innerText=o,useShadowRoot?t.shadowRoot.prepend(n):(document.head.appendChild(n),globalStyles.push(e))}};function register(t){return new Promise(async(e,n)=>{let o=await getComponentDefinition(t);null!=o?(components[o.componenentClassName]=o,customElements.define(o.tagName,o.module),e(o)):n()})}function toKebabCase(t){return t=t.replace(/\\.+$/,"").replace(/[^\w\d\s]/g,"").replace(/\s+/g,"-").replace(/[A-Z]+/g,function(t,e,n){return 0==n.indexOf(t)?t:"-"==n.substring(n.indexOf(t)-1,n.indexOf(t))?t:"-"+t}).toLowerCase()}function request(t,e,n,o){if(null==t||"[object String]"!=Object.prototype.toString.call(t)||""==t.trim())throw new Error("Cannot request a resource without a route.");return e=e||n?"POST":"GET",o=o,fetch(t,{method:e,body:n,headers:o,referrer:"no-referrer"}).then(function(t){return t.ok?t:Promise.reject(t)}).catch(function(t){console.error("There was an error requesting the resource.",t)})}async function getManifest(){let t=await request(manifestPath);return await t.json()}async function getComponentDefinition(t){try{let e;if(null==(e="[object String]"==Object.prototype.toString.call(t)?ObtuseComponentDefinition.new(t):ObtuseComponentDefinition.fromResource(t)))throw new Error(new Error("Unable to load component from manifest entry: "+JSON.stringify(t)));return await e.init(),e}catch(t){console.error(t)}}